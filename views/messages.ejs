<%- include("./shared/header.ejs") %>

<div class="container my-5">
  <%- include("./shared/verifyEmailAlert.ejs", { page: 'messages' }) %>

  <!-- User Card -->
  <div class="card text-center py-5 shadow-sm">
    <a href="#" data-bs-toggle="modal" data-bs-target="#share">
      <img 
        src= "<%= user.photo %>"
        class="avatar mb-3" 
        alt="User Photo" 
      />
    </a>
    <h3><%= user?.name %></h3>
    <p class="text-muted">@<%= user?.username %></p>

    <button data-bs-toggle="modal" data-bs-target="#share" class="btn btn-default-outline rounded-pill px-4">
      <i class="fas fa-share-alt"></i> Share Profile
    </button>
  </div>

  <!-- Share Profile Modal -->
  <div class="modal fade" id="share" tabindex="-1" aria-labelledby="shareLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content text-center p-3">
        <div class="modal-header border-0">
          <h5 class="modal-title w-100" id="shareLabel" style="color:#10bbb3;">Share Profile</h5>
          <button type="button" class="btn btn-close" data-bs-dismiss="modal">X</button>
        </div>
        <div class="modal-body">
          <p class="mb-3 text-muted">Copy and share your public profile link to start receiving messages</p>
          <div class="input-group mb-3">
            <input 
              type="text" 
              readonly 
              class="form-control text-center" 
              value="<%= `${fullUrl}/u/${user?.username}` %>" 
              id="profileLink"
            >
            <button class="btn btn-default-outline" id="copyBtn">Copy</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Messages Section -->
  <section class="messages-section my-5">
    <div class="text-center mb-4">
      <h2 class="fw-bold">Your Messages</h2>
    </div>

    <!-- Tabs -->
    <ul class="nav nav-pills justify-content-center mb-4" id="msgTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="received-tab" data-bs-toggle="pill" data-bs-target="#received" type="button" role="tab">
          Received
          <i class="fas fa-message"></i>
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="fav-tab" data-bs-toggle="pill" data-bs-target="#favourite" type="button" role="tab">
          Favourites
          <i class="fas fa-star"></i>
        </button>
      </li>
    </ul>

    <!-- Controls -->
    <div id="received-ctrls" class="d-flex justify-content-between align-items-center mb-3">
      <div class="sort-wrapper">
      <i class="fas fa-filter"></i>
        <select id="sort" class="form-select d-inline-block w-auto">
          <option value="newest">Newest First</option>
          <option value="oldest">Oldest First</option>
        </select>
      </div>

      <form class="form form--deleteallmsgs">
        <button type="submit" class="btn btn-danger btn-sm">
          <i class="fas fa-trash-alt"></i> Delete All
        </button>
      </form>
    </div>

    <!-- Tabs Content -->
    <div class="tab-section">
        <div class="loading-anim" id="loadingAnim">
          <dotlottie-wc
          class="dotlottie-player"
          src="https://lottie.host/3840ca4a-2787-4704-b958-75f6de37b9db/FUQsOSrUoH.lottie"
          autoplay loop>
        </dotlottie-wc>
      </div>
      
      <div class="tab-content">
        <div class="tab-pane fade show active" id="received" role="tabpanel"></div>
        <div class="tab-pane fade" id="favourite" role="tabpanel"></div>
      </div>
    </div>
  </section>
</div>

<!-- Delete Confirm Modal -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      
      <div class="modal-header">
        <h5 class="modal-title text-danger">Confirm Delete</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal">X</button>
      </div>

      <div class="modal-body">
        <p class="text-center fs-5">Are you sure you want to delete?<br>This action cannot be undone.</p>
      </div>

      <div class="modal-footer d-flex justify-content-end">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button id="confirmDeleteBtn" type="button" class="btn btn-danger">Yes, Delete</button>
      </div>

    </div>
  </div>
</div>


<!-- OTP Modal -->
<%- include("./shared/otpModal.ejs") %>

<%- include("./shared/footer.ejs") %>

<style>
  .loading-anim {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(1px);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 50;
  }

  .tab-section {
    position: relative;
    min-height: 200px;
  }

  .dotlottie-player {
    width: 50%;
    height: auto;
  }
</style>