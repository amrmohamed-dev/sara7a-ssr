  <div class="msgs-count-badge">
    All Messages: <span id="msgs-count"><%= msgs.length || 0 %></span>
  </div>

  <% if (!msgs?.length) { %>
    <div class="empty-state shadow-sm text-center py-4">
      You don't have any <%= id %> messages yet...
    </div>
  <% } else { %>
    <% msgs.forEach(msg => { %>
      <div class="message-card shadow-sm p-3 mb-3 rounded <%= msg.sender ? 'message-card--known' : 'message-card--anon' %>">
        <div class="message-header">
          <div class="sender-avatar">
            <img
              src="<%= msg.sender?.photo || '/img/users/static/avatar.png' %>"
              alt="Sender avatar"
            >
            <span class="sender-badge <%= msg.sender ? 'sender-badge--known' : 'sender-badge--anon' %>">
              <%= msg.sender ? 'Known' : 'Unknown' %>
            </span>
          </div>
          <% if (msg.sender) { %>
            <a href="/u/<%= msg.sender.username %>" target="_blank">
          <% } %>
            <div class="sender-meta">
              <div class="sender-name">
                <%= msg.sender ? msg.sender.name : 'anonymous sender' %>
              </div>
              <div class="sender-username">
                <%= msg.sender ? '@' + msg.sender.username : 'â€”' %>
              </div>
            </div>
          <% if (msg.sender) { %>
            </a>
          <% } %>
          <small class="text-muted msg-time"><%= timeSince(msg.createdAt) %></small>
        </div>
        <div class="message-bubble">
          <p class="mb-0"><%= msg.text %></p>
        </div>
        <% if (msg.image) { %>
          <div class="mt-3">
            <div id="imagePreview" class="mt-3 text-center">
              <a href="<%=msg.image%>" target="_blank">
                <img src="<%=msg.image%>" id="previewImg" class="img-fluid rounded" style="max-height: 200px;">
              </a>
            </div>
          </div>
        <% } %>
        <hr class="w-50">
        <div class="d-flex justify-content-end gap-2">
          <!-- Copy -->
          <button class="btn btn-outline-secondary btn-sm copy-btn" data-text="<%= msg.text %>">
            <i class="far fa-copy"></i> Copy
          </button>

          <!-- Add to Favourite -->
          <form class="fav-form" data-msgid="<%= msg._id %>">
            <button type="submit" 
              class="btn btn-outline-warning btn-sm"
              title="Add to Favourite">
              <i class="fas fa-star" style="color: <%= favSet?.has(msg.id) ? '#f1c40f' : '#b8b8b8' %>"></i>
            </button>
          </form>

          <!-- Delete -->
          <form class="d-inline form--deleteonemsg" data-msgid="<%= msg._id %>">
            <button type="submit" class="btn btn-outline-danger btn-sm btn-delete">
              <i class="fas fa-trash"></i> Delete
            </button>
          </form>
        </div>
      </div>
    <% }) %>
  <% } %>

