<%- include("./shared/header.ejs") %>

<style>
  textarea.form-control {
    resize: none;
    border-radius: 14px;
    border: 1px solid #ddd;
    padding: 14px;
    transition: all 0.2s ease;
    font-size: 17px;
  }

  .char-counter {
    text-align: right;
    font-size: 14px;
    color: #6c757d;
    margin-top: 6px;
  }

  .btn-send {
    font-size: 18px;
    padding: 12px 0;
    border-radius: 10px;
    transition: all 0.2s ease;
  }
</style>

<div class="container text-center py-5 my-5">
  <p class="sub-text">
    Write a message to <strong><%= publicUser?.name %></strong> without them
    knowing
  </p>
  <div class="card py-5 px-4 mb-5 shadow-sm">
    <img
      src= "<%= publicUser.photo %>"
      class="avatar mb-3"
      alt="User Photo"
    />
    <h3 class="py-1"><%= publicUser?.name %></h3>
    <p class="text-muted">@<%= publicUser?.username %></p>

    <div class="container w-75 w-md-50 m-auto">
      <form class="form form--send-msg" enctype="multipart/form-data">
        <textarea
          class="form-control"
          name="text"
          id="msg"
          cols="10"
          rows="7"
          placeholder="Send a Sara7a message to <%=publicUser?.name%> without them knowing..."
          minlength="6"
          maxlength="500"
          required
        ></textarea>
        <div class="char-counter">
          <span id="remaining" style="font-weight: bold">500</span>
          characters left
        </div>

        <input
          id="receiver"
          type="hidden"
          name="receiver"
          value="<%= publicUser?._id %>"
        />

        <div class="mt-3">
          <button type="button" id="addImageBtn" class="btn btn-outline-secondary w-100">
            <i class="fas fa-image"></i> Add Photo (optional)
          </button>

          <input 
            type="file" 
            id="msgImageInput" 
            name="msgImage" 
            accept="image/*" 
            class="d-none"
          />

          <div id="imagePreviewDiv" class="mt-3 d-none">
            <img src="" id="previewImg" class="img-fluid rounded" style="max-height: 200px;">
            <button type="button" id="removeImageBtn" class="btn btn-sm btn-danger mt-2 w-100">
              Remove Photo
            </button>
          </div>
      </div>


        <p class="notify text-danger <%= !publicUser.isVerified && publicUser.msgsCount >= 5 ? '' : 'd-none' %>" >
          <%= publicUser.name %> cannot receive more messages
        </p>

        <button class="btn btn-info btn-lg mt-3 w-100 btn--send-msg <%= publicUser.isVerified || publicUser.msgsCount < 5 ? '' : 'd-none' %>" >
          <i class="far fa-paper-plane"></i> Send
        </button>

        <div class="mt-2 d-flex justify-content-between align-items-center flex-wrap text-muted small">
        <span>
          <i class="fas fa-users text-primary"></i>
            Number of visits: <strong><%= publicUser.visitsCount || 0 %> </strong>
        </span>
        </div>
      </form>
    </div>
  </div>
</div>

<%- include("./shared/footer.ejs") %>
