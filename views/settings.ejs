<%- include("./shared/header.ejs") %>

<style>
.profile-wrapper {
  max-width: 800px;
  margin: 70px auto;
}

.card-custom {
  background: #fff;
  border-radius: 18px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.04);
  padding: 30px;
  margin-bottom: 25px;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.card-custom:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 14px rgba(0, 0, 0, 0.08);
}

.profile-card {
  text-align: center;
  padding: 40px 30px 30px;
  border-top: 4px solid #00b3a4;
}

.profile-card img {
  width: 110px;
  height: 110px;
  border-radius: 50%;
  object-fit: cover;
  margin-bottom: 15px;
  border: 3px solid #00b3a4;
}

.profile-card h4 {
  font-weight: 600;
  color: #222;
}

.section-title {
  font-size: 1.15rem;
  font-weight: 600;
  color: #00a091;
  text-align: center;
  margin-bottom: 25px;
}

.verify-status {
  font-size: 0.85rem;
  padding: 5px 10px;
  border-radius: 10px;
  font-weight: 500;
  white-space: nowrap;
}

.not-verified {
  background: #fff4f4;
  color: #c0392b;
  border: 1px solid #f3b7b7;
  cursor: pointer;
  transition: all 0.2s ease;
}

.not-verified:hover {
  background: #f8d7da;
}

.verified {
  background: #e9f9f4;
  color: #15803d;
  border: 1px solid #b4f0d0;
  cursor: default;
}

.user-stats {
  background: #f9f9f9;
  border-radius: 10px;
  padding: 10px 15px;
  margin-top: 15px;
  border: 1px solid #eee;
}

.user-stats i {
  color: #10bbb3;
}

.btn--save-data {
  background: #00b3a4;
  color: #fff;
  border-radius: 25px;
  border: none;
  width: 100%;
  padding: 10px 0;
  font-weight: 500;
  transition: background 0.3s ease;
}

.btn--save-data:hover {
  background: #009688;
}

.btn-success {
  background: #00b86b;
  border: none;
  border-radius: 25px;
  width: 100%;
  padding: 10px 0;
  font-weight: 500;
}

.btn-success:hover {
  background: #00a05b;
}

.btn--save-data:disabled,
.btn-success:disabled {
  background: #cfd3e1;
  cursor: not-allowed;
}

</style>

<div class="profile-wrapper">
  <%- include("./shared/verifyEmailAlert.ejs", { page: 'settings' }) %>

  <!-- Profile Picture + Name -->
  <div class="card-custom profile-card">
    <img src="/img/users/<%= (user?.photo) ? user.photo : 'static/avatar.png' %>" alt="User Photo">
    <h4><%= user.name %></h4>
  </div>

  <!-- Account Info -->
  <div class="card-custom">
    <h4 class="section-title">Account Info</h4>
    <form class="form form--user-data">
      <div class="form-group mb-4">
        <input
        type="text"
        id="name"
        class="form-control"
        placeholder=""
        value="<%= user.name %>"
        required
        <%= !user.isVerified ? 'disabled' : '' %>
        />
        <label class="form-label" for="name">Name</label>
      </div>

      <div class="form-group mb-4">
        <div class="d-flex align-items-center gap-2">
          <input
          type="email"
          id="email"
          class="form-control"
          placeholder=""
          value="<%= user.email %>"
          disabled
          />
          <label class="form-label" for="email">Email</label>
          <% if (!user.isVerified) { %>
            <span class="verify-status not-verified" id="verifyEmailBtn" data-email="<%=user.email%>">Not Verified</span>
          <% } else { %>
            <span class="verify-status verified">Verified âœ…</span>
          <% } %>
        </div>
      </div>

      <button
        class="btn btn--save-data mt-3"
        <%= !user.isVerified ? 'disabled' : '' %>
      >
        Save Changes
      </button>
      <!-- User Stats -->
      <div class="user-stats mt-4">
        <div class="d-flex justify-content-between align-items-center flex-wrap text-muted small">
          <span><i class="fas fa-users me-2 text-primary"></i>Visitors: <strong><%= user.visitorsCount || 0 %></strong></span>
          <span><i class="far fa-calendar-alt me-2 text-success"></i>Joined: 
            <strong>
              <%= new Date(user.createdAt).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' }) %>
            </strong>
          </span>
        </div>
      </div>
    </form>
  </div>

  <!-- Change Password -->
  <div class="card-custom">
    <h4 class="section-title">Change Password</h4>
    <form class="form form--update-password">
      <div class="form-group mb-4">
        <input
        type="password"
        id="current-password"
        class="form-control"
        placeholder=""
        minlength="8"
        required
        <%= !user.isVerified ? 'disabled' : '' %>
        />
        <label class="form-label" for="current-password">Current Password</label>
      </div>
      <div class="form-group mb-4">
        <input
        type="password"
        id="password"
        class="form-control"
        placeholder=""
        minlength="8"
        required
        <%= !user.isVerified ? 'disabled' : '' %>
        />
        <label class="form-label" for="password">New Password</label>
      </div>
      <div class="form-group mb-4">
        <input
        type="password"
        id="password-confirm"
        class="form-control"
        placeholder=""
        minlength="8"
        required
        <%= !user.isVerified ? 'disabled' : '' %>
        />
        <label class="form-label" for="password-confirm">Confirm New Password</label>
      </div>
      <button
        class="btn btn-success btn--update-password"
        <%= !user.isVerified ? 'disabled' : '' %>
      >
        Update Password
      </button>
    </form>
  </div>
  <!-- Delete Account -->
  <hr class="my-4" />
  <button
    type="button"
    class="btn btn-danger w-100 mt-2"
    id="deleteAccountBtn"
    data-bs-toggle="modal"
    data-bs-target="#deleteAccountModal"
  >
    Delete My Account
  </button>
  <!-- Delete Account Modal -->
<div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-3 border-0">
      <div class="modal-header border-0">
        <h5 class="modal-title fw-semibold text-danger">Delete Account</h5>
        <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close">&times;</button>
      </div>
      <div class="modal-body text-center">
        <p class="text-muted mb-3">
          <strong>Are you sure you want to delete your account?</strong><br />
          This action cannot be undone, and all your data will be permanently removed.
        </p>
        <div class="d-grid gap-3 mt-3">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            Cancel
          </button>
          <button type="button" class="btn btn-danger" id="confirmDeleteAccount">
            Yes, Delete
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
</div>

<!-- OTP Modal -->
<%- include("./shared/otpModal.ejs")%>

<%- include("./shared/footer.ejs") %>
